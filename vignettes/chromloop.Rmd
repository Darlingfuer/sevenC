---
title: "Prediction of chromatin looping interactions with *chromloop*"
shorttitle: "chromloop package"
author: 
- name: Jonas Ibn-Salem
  affiliation:
  - &JGU Faculty of Biology, Johannes Gutenberg University of Mainz, 55128 Mainz, Germany
  - &IMB Institute of Molecular Biology, 55128 Mainz, Germany 
  email: j.ibn-salem@uni-mainz.de
- name: Miguel Andrade-Navarro
  affiliation:
    - *JGU
    - *IMB
package: chromloop
abstract: >
  Chromatin looping is an importent feature of
  eukaryotic genomes and can bring regulatory sequences, such as enhancers or 
  transcription factor binding sites, in close physical proximity of regulated 
  target genes.
  Here, we provide a tool that uses protein binding signals from ChIP-seq and
  sequence motif information to predict chromatin looping events. Cross-linking 
  of proteins binding close to loop anchors result in ChIP-seq signals at both 
  anchor loci. These signals are used at CTCF motif pairs together with their 
  distance and orientation to each other to predict whether they interact or not.
  The resulting chromatin loops can be used to associate enhancers or 
  transcription factor binding sites in form of ChIP-seq peaks to regulated 
  target genes.
output:
  BiocStyle::html_document:
    toc_float: true
  BiocStyle::pdf_document:
bibliography: chromloop.bib
vignette: >
  %\VignetteIndexEntry{Introduction to chromloop}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---
# Introduction

Gene expression is regulated by bindig of transcription factors (TF) to genomic DNA. 
However, many binding sites are in distal regulatory region, such as enhancers, that are hundreds of kilo bases apart of genes.
These regulatory regoins can physically interact with promoters of regulated genes by chromatin looping interactions. 
These looping interaction can be meseared genome wide by chromatin conformation capture techniques such as Hi-C or ChIA-PET [@Rao2014, @Tang2015a]. Dispite many exciting insights into the three-dimensional organization of genoms, thse experimental methods are not only elaborate and expencsive but also require require lots of sample material (in case of ChIA-PET) or have limited resolution of 5-40 kb (in case of Hi-C). 

In contrast, the binding sites of TFs can be detected genome-weide by ChIP-seq experiment which are availabel for hundreds of TFs in many cell type and conditions. However, classical analysis of ChIP-seq gives only the direct binding sites of targeted TFs (peaks) and it is not trivial to associate them to the regualted gene without chomatin looping information.

Therefore, we provide a computational mehtod to predict chromatin interactions from only genomic sequence feqtures and ChIP-seq data. 
The predicted looping interacitons can be used to associate TF binding sites (ChIP-seq peaks) or enhancers to regulated genes and thery improve functional downstream analysis on the level of genes.

In this vignette, we show how to use the R package `r Biocpkg("chromloop")` to predict chromatin looping interactions between CTCF motifs by using only ChIP-seq data form a single experiment. 
Furthermore, we show how to train the the prediction model using custom data.


## Predict chromatin interaction form a single ChIP-seq experiment

Here we show how to use the package to predict chromatin looping interactions 
among CTCF moif locations on chromosome 22. 
As input only a single bigWig file is used with coverage from a STAT1 ChIP-seq experiment 
in human GM12878 cells[^1]. 

[^1]: An example file with only data on a subset of chromsome 22 is provied as part of 
the `r Biocpkg("chromloop")` package. The full file can be downloaded from ENCODE [@Dunham2012]  [here](http://hgdownload.cse.ucsc.edu/goldenPath/hg19/encodeDCC/wgEncodeSydhTfbs/wgEncodeSydhTfbsGm12878Stat1StdSig.bigWig).

### Prepare CTCF motif pairs
First, we need to preapare CTCF motif pairs as candiate achros for chromatin loop interactions. 
We use CTCF motif hits in human chromsome 22 as provied by `r Biocpkg("chromloop")` package.

```{r, results = "hide", message = FALSE}
library(chromloop)
library(InteractionSet)

# load provided CTCF motifs
motifs <- motif.hg19.CTCF.chr22
```
The CTCF motif are represented as `GRanges` object from the `r Biocpkg("GenomicRanges")` package. 

```{r}
class(motifs)

motifs
```
There are `r length(motifs)` CTCF motif locations on chromosome 22. 
The genome assembly is hg19. 
Four metadata columns show motif match similarity as weihgt score, p-value, log transformed p-value and significance score. 
Use `help(motif.hg19.CTCF)` to get more infromation on the motif dataset.

Now we build a dataset with all pairs of CTCF motif wihin 1 mega basepair and annotate it with distnace, mtoif oreintation, and motif score. 
```{r}
gi <- prepareCandidates(motifs, maxDist = 10^6, scoreColname = "sig")

gi
```
The return value `gi` of the function `prepareCandidates()` is `GInteractoin` object from the `r Biocpkg("InteractonSet")` package. 

### Parse ChIP-seq signals and compute similarity at motif pairs

Now we read an example bigWig file wiht ChIP-seq signals. For each position along the genome, the file contains the log fold-chnage of ChIP signals compared to imput control. A sample file with data on a subset of chromosome 22 is provided in the package. 
```{r}
# use example ChIP-seq bigWig file
bigWigFile <- system.file("extdata", "GM12878_Stat1.chr22_1-18000000.bigWig", 
  package = "chromloop")

# add ChIP-seq coverage and compute correaltion at motif pairs
gi <- addCor(gi, bigWigFile)
```

### Predict loops
Now we can predict chromatin loops using the default trained model. 
```{r}
loops <- predLoops(gi)

loops
```
This result in a subset of motif pairs that are predicted to interact. The interactions are annotated wiht ChIP-seq correlation in column `chip` and interaction probability in `pred`.

### Write predicted loops to output file
Since looping interactions are stored as `GInteraction` objects, they 
can be exported as 
[BED-PE](http://bedtools.readthedocs.io/en/latest/content/general-usage.html#bedpe-format) 
files using functions from `r Biocpkg("GenomicInteractions")` package.

```{r, message = FALSE}
require(GenomicInteractions)

# export to output file
export.bedpe(loops, "loop_interactions.bedpe", score = "pred")

```


## Train Prediciton model using custom looping data



<!-- ## Figures -->

<!-- The figure sizes have been customised so that you can easily put two images side-by-side.  -->

<!-- ```{r, fig.show='hold'} -->
<!-- plot(1:10) -->
<!-- plot(10:1) -->
<!-- ``` -->

<!-- You can enable figure captions by `fig_caption: yes` in YAML: -->

<!--     output: -->
<!--       rmarkdown::html_vignette: -->
<!--         fig_caption: yes -->

<!-- Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**. -->

<!-- ## More Examples -->

<!-- You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`. -->

<!-- ```{r, echo=FALSE, results='asis'} -->
<!-- knitr::kable(head(mtcars, 10)) -->
<!-- ``` -->

<!-- Also a quote using `>`: -->

<!-- > "He who gives up [code] safety for [code] speed deserves neither." -->
<!-- ([via](https://twitter.com/hadleywickham/status/504368538874703872)) -->

# References

